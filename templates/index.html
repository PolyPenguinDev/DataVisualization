<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Camera Passthrough</title>
    <style>
        body, html {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100%;
            margin: 0;
            background-color: #000;
            overflow: hidden;
        }
        video, img {
            pointer-events: none;
            z-index: 1000;
            position: fixed;
            max-width: 100%;
            max-height: 100%;
            margin-top: 10px;
        }
        #blur {
            scale: 1.05;
            display: flex;
            position: fixed;
            top: 0px;
            filter: blur(8px);
        }
        #blurb {
            scale: 1.05;
            display: flex;
            position: fixed;
            bottom: 0px;
            filter: blur(8px);
        }

        button {
            z-index: 2000;
            bottom: 20px;
            position: fixed;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background-color: #ffffffaa;
            border: 6px solid #fff;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            margin-top: 10px;
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.5); /* Optional shadow for depth */
            padding: 10px; /* Add padding here */
            box-sizing: border-box; /* Ensure padding is included in total width/height */
            transition: transform 0.1s; /* Smooth transition for button effect */
        }
        button:active {
            transform: scale(0.95); /* Button effect on click */
        }
		
		
		.movingPicture {
			transform: translate3d(0, -100%, 0);
			scale: 0.5;
			transition: transform 1s ease, scale 1s ease;
		}
		
		.dissappearingBlur{
			opacity: 0;
			transition: opacity 1s;
		}
    </style>
</head>
<body>
    
    <video id="blur" autoplay playsinline disablePictureInPicture></video>
    <video id="blurb" autoplay playsinline disablePictureInPicture></video>
    <video id="camera" autoplay playsinline disablePictureInPicture></video>
    <button onclick="captureFrame()" id="button"></button>
    
	
    <script>
        var latitude=null
        var longitude = null
        var elevation = null
        function getLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(showPosition);
            }
        }

        function showPosition(position) {
            latitude= position.coords.latitude
            console.log(latitude)
            longitude = position.coords.longitude
            console.log(longitude)
            fetch("https://api.open-elevation.com/api/v1/lookup?locations="+latitude+","+longitude)
            .then(response => {
                // Check if the response is OK (status code 200-299)
                if (!response.ok) {
                    throw new Error('Network response was not ok ' + response.statusText);
                }
                return response.json(); // Parse the JSON from the response
            })
            .then(data => {
                console.log(data)
                elevation = data["results"][0]["elevation"]+5
                console.log(elevation)
            })
        }
        let stream;
		

        async function startCamera() {
            try {
                stream = await navigator.mediaDevices.getUserMedia({
                    video: { facingMode: "environment" }
                });
                const video = document.getElementById('camera');
                video.srcObject = stream;
                const blura = document.getElementById('blur');
                blura.srcObject = stream;
                const blurb = document.getElementById('blurb');
                blurb.srcObject = stream;
            } catch (error) {
                console.error("Error accessing the camera:", error);
                alert("Could not access the camera.");
            }
        }
        
        function captureFrame() {
            var snapshot = document.createElement('img');
            snapshot.id = "snapshot";
            
            const video = document.getElementById('camera');
            const blura = document.getElementById('blur');
            const blurb = document.getElementById('blurb');
            const canvas = document.createElement('canvas');
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;

            const context = canvas.getContext('2d');
            context.drawImage(video, 0, 0, canvas.width, canvas.height);
            snapshot.src = canvas.toDataURL('image/png');

            //stream.getTracks().forEach(track => track.stop());
            document.body.appendChild(snapshot);
            video.remove();
            document.getElementById("button").remove();
			
			document.getElementById("snapshot").classList.add("movingPicture")
			blura.classList.add("dissappearingBlur")
			blurb.classList.add("dissappearingBlur")
			setTimeout(() => {stream.getTracks().forEach(track => track.stop())}, 1500)
			blura.remove()
			blurb.remove()
        }
        getLocation()
        startCamera();
    </script>
</body>
</html>
